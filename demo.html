<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta charset="utf-8"/>
<html><head></head><body></body>

<script src="u1.js"></script>
<script>
"use strict";

logToConsole();

var SAMPLE_UINL = new Map([

    ['text', `{"value":[
 "Hello World!",
 "UINL container is just a list of item declarations",
 {"id":"More Text","value":[
  "here's more text",
  "there's more text"
 ]}
]}`],

    ['buttons', `{"value":[
 {"id":"Click me","class":"btn"},
 {"id":"No, click me","class":"btn"},
 {"id":"Hold me","class":"hold"}
]}`],

['text inputs', `{"value":[
  "to change a text field into input, use \\"in\\" property",
  "if text has a newline character, it will become multi-line text input",
  {"id":"name","value":"","input":1},
  {"id":"message","value":"\\n","input":1}
]}`],

    ['numbers and time', `{"value":[
  {"class":"num","id":"money","unit":"$","step":0.01,"value":40.25},
  {"id":"numeric input","value":0,"input":1,"step":5,"min":0,"max":100},
  {"class":"dt","id":"date and time","value":1677508000,"step":60},
  {"class":"dt","id":"date input","value":1677508000,"step":86400,"input":1},
  {"class":"time","id":"time input","step":0.1,"value":564,"input":1}
]}`],

    ['container w/ checkboxes', `{"value":[
 {
  "id":"Choose cars",
  "defaults":{"class":"opt"},
  "value":[
   {"id":"Subaru"},
   {"id":"Ford"},
   {"id":"Tesla"}
  ]
 }
]}`],

    ['container w/ radio buttons', `{"value":[
 {
  "id":"Choose a car",
  "defaults":{"class":"opt","optionGroup":"cars"},
  "value":[
   {"id":"Subaru"},
   {"id":"Ford"},
   {"id":"Tesla"}
  ]
 }
]}`],

    ['table', `{"value":[
 {
  "id":"Personnel",
  "class":"grid",
  "headerRow":1,
  "defaults":{
    "optionGroup":"wrk",
    "step":0.01,
    "unit":"$"
  },
  "value":[
   ["Name","Gender","Salary","Working this week"],
   {"id":"P801","value":["Max Brownwell","female",22.75,{"class":"opt"}]},
   {"id":"P807","value":["Carrie Vanilla","male",22,{"class":"opt"}]},
   {"id":"P811","value":["Jenny Jerrings","female",21,{"class":"opt"}]},
   {"id":"P832","value":["Jerry Jennings","male",21,{"class":"opt"}]}
  ]
 },
 "there are twenty-five UI component classes in UINL, several of which are container widgets, including table, win (popup), and one (tabs)"
]}`],

['tabs', `{"value":[
 {
  "id":"Personnel",
  "class":"one",
  "defaults":{
    "step":0.01,
    "unit":"$"
  },
  "value":[
   {"id":"P801","value":[{"id":"Name","value":"Max Brownwell"},{"id":"Gender","value":"female"},{"id":"Salary","value":22.75}]},
   {"id":"P807","value":[{"id":"Name","value":"Carrie Vanilla"},{"id":"Gender","value":"male"},{"id":"Salary","value":22}]},
   {"id":"P811","value":[{"id":"Name","value":"Jenny Jerrings"},{"id":"Gender","value":"female"},{"id":"Salary","value":21}]},
   {"id":"P832","value":[{"id":"Name","value":"Jerry Jennings"},{"id":"Gender","value":"male"},{"id":"Salary","value":21}]}
  ]
 },
 "component class \\"one\\" is used to display a widget with several visible containers of which only one is visible at a time (e.g., tabs, carousel, accordion)"
]}`],

['windows', `{"value":[
 {
  "id":"Personnel",
  "defaults":{
    "class":"win",
    "closeable":1,
    "foldable":1,
    "step":0.01,
    "unit":"$"
  },
  "value":[
   {"id":"P801","value":[{"id":"Name","value":"Max Brownwell"},{"id":"Gender","value":"female"},{"id":"Salary","value":22.75}]},
   {"id":"P807","value":[{"id":"Name","value":"Carrie Vanilla"},{"id":"Gender","value":"male"},{"id":"Salary","value":22}]},
   {"id":"P811","value":[{"id":"Name","value":"Jenny Jerrings"},{"id":"Gender","value":"female"},{"id":"Salary","value":21}]},
   {"id":"P832","value":[{"id":"Name","value":"Jerry Jennings"},{"id":"Gender","value":"male"},{"id":"Salary","value":21}]}
  ]
 },
 {"class":"win","modal":1,"closeable":1,"value":[
    "This is a popup!"
 ]},
 "Component class \\"win\\" is used to display a window. Use \\"modal\\":1 property to change the window into a modal popup."
]}`],

    ['context menu',`{"value":[
 {
  "value":"Right-click (or long-tap) on me for menu",
  "ctx":{"value":[
   "This is a context menu",
   {"c":"opt","id":"Select Me"},
   {"c":"btn","id":"Menu Option 1"},
   {"c":"btn","id":"Menu Option 2"},
   {"c":"btn","id":"Menu Option 3"}
  ]}
 },
 {
  "c":"btn",
  "id":"Click me for Menu",
  "ctx":{"toggle":1,"value":[
   "This is a context menu",
   {"c":"opt","id":"Select Me"},
   {"c":"btn","id":"Menu Option 1"},
   {"c":"btn","id":"Menu Option 2"},
   {"c":"btn","id":"Menu Option 3"}
  ]}
 },
 {
  "c":"hold",
  "id":"Hold me for Menu",
  "ctx":{"toggle":1,"value":[
   "This is a context menu",
   {"c":"opt","id":"Select Me"},
   {"c":"btn","id":"Menu Option 1"},
   {"c":"btn","id":"Menu Option 2"},
   {"c":"btn","id":"Menu Option 3"}
  ]}
 }

]}`],

// TODO: add plot/data, gr, animation

]);


var lastValue;


function userEvent(event){
    var itemId=event.u,itemValue=event.v,uinl,display={Q:[]};
    if(event.t<=1){  // on handshake
        display.caption='UINL demo';
        display.require={c:['grid','opt','doc'],fmt:['mkdn'],caption:[]};
        display.style=`
                #Preview {padding:5px}
                #Warning {text-align:right;}
                #Warning * {display:inline}

                #Preview {background:linear-gradient(to bottom left,white 75%,#dee 85%,#9aa);box-shadow:-1px -1px 1px lightgray}
                #Warning {color:#a00}
                #Warning>.title:after {content:":"}
                @media (prefers-color-scheme: dark) {
                    #Preview {background:linear-gradient(to bottom right,#182028 75%,#244 85%,#9aa);box-shadow:-1px -1px 1px #555}
                    #Warning {color:#d22}
                }
            `;
        display.v=[
            {id:"Preview"},
            {id:"Sample Code",v:[...SAMPLE_UINL.keys()].map(x=>({id:x,c:'btn'}))},
            {id:"UINL",cap:"APP→UI message (presuming a blank display)",v:"\n",in:1,on:{v:[]}}
        ];
    }else{
        display.Q=[];
        display.Q.push({U:'UI→APP message',v:null});
        let addItems=[];
        if(itemId=='UINL'){
            try{
                uinl=JSON.parse(itemValue);
                if(uinl.constructor===Object){
                    itemValue=JSON.stringify(uinl);
                    if(itemValue!==lastValue){
                        lastValue=itemValue;
                        uinl.id='Preview';
                        uinl.i=0;
                        // display.Q.push(uinl);
                        display.Q.push({U:'Warning',v:null});
                        display.Q.push({U:'Preview',v:null});
                        addItems.push(uinl);
                    }
                }else{
                    display.Q.push({U:'Warning',v:null});
                    display.Q.push({id:'Warning',v:'APP→UI message must be a JSON object.'});
                }
            }catch(e){
                if(e.message.includes('JSON')){
                    display.Q.push({U:'Warning',v:null});
                    addItems.push({id:'Warning',v:'Invalid JSON string'});
                }else{
                    throw(e);
                }
            }
        }else if(SAMPLE_UINL.has(itemId)){
            lastValue=SAMPLE_UINL.get(itemId);
            display.Q.push({U:'UINL',v:lastValue});
            uinl=JSON.parse(lastValue);
            uinl.id='Preview';
            uinl.i=0;
            display.Q.push({U:'Warning',v:null});
            display.Q.push({U:'Preview',v:null});
            addItems.push(uinl);
        }else if('!' in event){
            display.Q.push({U:'Warning',v:null});
            addItems.push({id:'Warning',v:event['!']});
        }else{
            addItems.push({id:'UI→APP message',v:JSON.stringify(event)});
        }
        display.Q.push({add:addItems});
    }
    app.display(display);
}
</script>
</html>
