<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta charset="utf-8"/>
<html><head></head><body></body>

<script src="u1.js"></script>
<script>
"use strict";

logToConsole();

var SAMPLE_UINL = new Map([

    ['text', `{"v":[
 "Hello World!",
 "UINL container is just a list of item declarations",
 {"id":"More Text","v":[
  "here's more text",
  "there's more text"
 ]}
]}`],

    ['buttons', `{"v":[
 {"id":"Press me","c":"btn"},
 {"id":"No, press me","c":"btn"},
 {"id":"Hold me","c":"hold"}
]}`],

['text inputs', `{"v":[
  "to change a text field into input, use \\"in\\" property",
  "if text has a newline character, it will become multi-line text input",
  {"id":"name","v":"","input":1},
  {"id":"message","v":"\\n","input":1}
]}`],

    ['numbers and time', `{"v":[
  {"c":"num","id":"money","unit":"$","step":0.01,"v":40.25},
  {"id":"numeric input","v":0,"input":1,"step":5,"min":0,"max":100},
  {"c":"dt","id":"date and time","v":1677508000,"step":60},
  {"c":"dt","id":"date input","v":1677508000,"step":86400,"input":1},
  {"c":"time","id":"time input","step":0.1,"v":564,"input":1}
]}`],

// ['numbers and time', `{"v":[
//   {"id":"numeric input","v":0,"in":1,"step":5,"min":0,"max":100},
//   {"c":"num","id":"money","step":0.25,"unit":"$",
//     "+v":{"+":1}},
//   {"c":"time","id":"time","step":0.1,
//     "+v":{"+":1}},
//   {"c":"dt","id":"date","v":946684800,"step":86400,
//     "+v":{"+":86400}}
// ]}`],

    ['container w/ checkboxes', `{"v":[
 {
  "id":"Choose cars",
  "defaults":{"c":"opt"},
  "v":[
   {"id":"Subaru"},
   {"id":"Ford"},
   {"id":"Tesla"}
  ]
 }
]}`],

    ['container w/ radio buttons', `{"v":[
 {
  "id":"Choose a car",
  "defaults":{"c":"opt","optionGroup":"cars"},
  "v":[
   {"id":"Subaru"},
   {"id":"Ford"},
   {"id":"Tesla"}
  ]
 }
]}`],

    ['table', `{"v":[
 {
  "id":"Personnel",
  "c":"grid",
  "headerRow":1,
  "defaults":{
    "optionGroup":"wrk",
    "step":0.01,
    "unit":"$"
  },
  "v":[
   ["Name","Gender","Salary","Working this week"],
   {"id":"P801","v":["Max Brownwell","female",22.75,{"c":"opt"}]},
   {"id":"P807","v":["Carrie Vanilla","male",22,{"c":"opt"}]},
   {"id":"P811","v":["Jenny Jerrings","female",21,{"c":"opt"}]},
   {"id":"P832","v":["Jerry Jennings","male",21,{"c":"opt"}]}
  ]
 },
 "there are twenty-five UI component classes in UINL, several of which are container widgets, including table, win (popup), and one (tabs)"
]}`],

    ['tabs', `{"v":[
 {
  "id":"Personnel",
  "c":"one",
  "defaults":{
    "step":0.01,
    "unit":"$"
  },
  "v":[
   {"id":"P801","v":[{"id":"Name","v":"Max Brownwell"},{"id":"Gender","v":"female"},{"id":"Salary","v":22.75}]},
   {"id":"P807","v":[{"id":"Name","v":"Carrie Vanilla"},{"id":"Gender","v":"male"},{"id":"Salary","v":22}]},
   {"id":"P811","v":[{"id":"Name","v":"Jenny Jerrings"},{"id":"Gender","v":"female"},{"id":"Salary","v":21}]},
   {"id":"P832","v":[{"id":"Name","v":"Jerry Jennings"},{"id":"Gender","v":"male"},{"id":"Salary","v":21}]}
  ]
 },
 "component class \\"one\\" is used to display a widget with several visible containers of which only one is visible at a time (e.g., tabs, carousel, accordion)"
]}`],

// TODO: add plot


//     ['animation2', `{"v":[
//  {"h":100,"w":200,
//   "df":{
//       "w":15,"h":15,"shp":1,"tag":[0],
//       "+x":{"ta":-10,"tu":9e99},
//       "+y":{"to":83,"ta":300,"te":"-0.5","tu":10}
//   },
//   "v":[
//     {"+x":{"+":80,"to":[183,0]}},
//     {"x":183,"+x":{"+":-80,"to":[0,183]}}
//   ]
//  }
// ]}`],

//     ['animation', `{"v":[
//  {"h":100,"w":200,"v":[
//    {"w":15,"h":15,"shp":1,"tag":[0],
//     "+x":{"to":[183,0],"+":80,"ta":-10},
//     "+y":{"to":83,"ta":300,"te":"-0.5","tu":10}}
//   ]
//  }
// ]}`],

//     ['lines and axes',`{"v":[
//  {"id":"some data",
//   "w":200,"h":200,"iw":300,"ih":20,
//   "axisx":{"title":"times","c":"time","step":60},
//   "axisy":{"title":"scores","min":-10,"max":10},
//   "df":{"cc":3,"bb":2},
//   "v":[
//    {"x":0,"y":10,"tag":["series1"]},
//    {"x":60,"y":15,"tag":["series1"]},
//    {"x":120,"y":13,"tag":["series1"]},
//    {"x":180,"y":5,"tag":["series1"]},
//    {"x":240,"y":1,"tag":["series1"]},
//    {"x":0,"y":12,"tag":["series2"]},
//    {"x":60,"y":14,"tag":["series2"]},
//    {"x":120,"y":10,"tag":["series2"]},
//    {"x":180,"y":9,"tag":["series2"]},
//    {"x":240,"y":8,"tag":["series2"]},
//    {"c":"l","tag":["series1"]},
//    {"c":"l","tag":["series2"]}
//   ]
//  }
// ]}`],

]);


var lastValue;


function userEvent(msg){
    var itemId=msg.u,itemValue=msg.v,uinl,display={Q:[]};
    if(msg.t<=1){  // on handshake
        display.cap='UINL demo';
        display.require={c:['grid','opt','doc'],fmt:['mkdn']};
        display.style=`
                #Preview {background:linear-gradient(to bottom left,white 75%,#dee 85%,#9aa);box-shadow:-1px -1px 1px lightgray;padding:5px}
                #Warning {text-align:right;color:#a00}
                #Warning * {display:inline}
                
                .series1 {--rotate:45deg !important;background-color:#fa8;border-width:3px;border-color:#da8;color:#da8}
                .series2 {border-radius:100%;background-color:#8af;border-width:3px;border-color:#8ad;color:#8ad}
            `;
        display.v=[
            {id:"Preview"},
            {id:"Sample Code",v:[...SAMPLE_UINL.keys()].map(x=>({id:x,c:'btn'}))},
            {id:"UINL",cap:"APP→UI message (presuming a blank display)",v:"\n",in:1,on:{v:[]}}
        ];
    }else{
        display.Q=[];
        display.Q.push({U:'UI→APP message',v:null});
        display.Q.push({U:'Warning',v:null});
        let v=[];
        if(itemId=='UINL'){
            try{
                uinl=JSON.parse(itemValue);
                if(uinl.constructor===Object){
                    itemValue=JSON.stringify(uinl);
                    if(itemValue!==lastValue){
                        lastValue=itemValue;
                        uinl.id='Preview';
                        uinl.i=0;
                        // display.Q.push(uinl);
                        display.Q.push({U:'Preview',v:null});
                        v.push(uinl);
                    }
                }else{
                    display.Q.push({id:'Warning',v:'APP→UI message must be a JSON object.'});
                }
            }catch(e){
                if(e.message.includes('JSON')){
                    v.push({id:'Warning',v:'Invalid JSON string'});
                }else{
                    throw(e);
                }
            }
        }else if(SAMPLE_UINL.has(itemId)){
            lastValue=SAMPLE_UINL.get(itemId);
            display.Q.push({U:'UINL',v:lastValue});
            uinl=JSON.parse(lastValue);
            uinl.id='Preview';
            uinl.i=0;
            display.Q.push({U:'Preview',v:null});
            v.push(uinl);
        }else{
            v.push({id:'UI→APP message',v:JSON.stringify(msg)});
        }
        display.Q.push({A:v});
    }
    app.display(display);
}
</script>
</html>
